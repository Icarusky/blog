<!--
//
//  FOOT STYLES
//––––––––––––––––––––––––––––––––––––––––––––––––––
-->

<!--
//
//  MAIN
//––––––––––––––––––––––––––––––––––––––––––––––––––
-->
<!-- Main CSS. -->
<link rel="preload" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "main.css" }}" as="style" onload="this.onload=null;this.rel='stylesheet'" />
<noscript><link rel="preload" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "main.css" }}" /></noscript>

<!-- Google Font. -->
<link href="https://fonts.googleapis.com/css?family=Volkhov:400,700" rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link href="https://fonts.googleapis.com/css?family=Volkhov:400,700" rel="stylesheet"></noscript>


<!--
//
//  PAGE-SPECIFIC CSS
//––––––––––––––––––––––––––––––––––––––––––––––––––
-->
<!-- Article-specific -->
{{ if and (eq .Type "articles") (eq .Kind "page") }}
<link rel="preload" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "single-article.css" }}" as="style" onload="this.onload=null;this.rel='stylesheet'" />
<noscript><link rel="stylesheet" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "single-article.css" }}" /></noscript>

  {{ if isset .Params "custom_stylesheet" }}
    {{ $.Scratch.Add "stylesheet_filename" "article-" }}
    {{ $.Scratch.Add "stylesheet_filename" .Params.custom_stylesheet }}
    {{ $.Scratch.Add "stylesheet_filename" ".css" }}
<link rel="preload" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash ($.Scratch.Get "stylesheet_filename") }}" as="style" onload="this.onload=null;this.rel='stylesheet'" />
<noscript><link rel="stylesheet" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash ($.Scratch.Get "stylesheet_filename") }}" /></noscript>
  {{ end }}
{{ end }}

<!-- Work-specific -->
{{ if and (eq .Type "work") (eq .Kind "page") }}
<link rel="preload" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "work.css" }}" as="style" onload="this.onload=null;this.rel='stylesheet'" />
<noscript><link rel="stylesheet" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "work.css" }}" /></noscript>
  {{ if isset .Params "custom_stylesheet" }}
    {{ $.Scratch.Add "stylesheet_filename" "work-" }}
    {{ $.Scratch.Add "stylesheet_filename" .Params.custom_stylesheet }}
    {{ $.Scratch.Add "stylesheet_filename" ".css" }}
<link rel="preload" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash ($.Scratch.Get "stylesheet_filename") }}" as="style" onload="this.onload=null;this.rel='stylesheet'" />
<noscript><link rel="stylesheet" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash ($.Scratch.Get "stylesheet_filename") }}" /></noscript>
  {{ end }}
{{ end }}

<!-- Work listing -->
{{ if and (eq .Type "work") (eq .Kind "section") }}
<link rel="preload" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "work.css" }}" as="style" onload="this.onload=null;this.rel='stylesheet'" />
<noscript><link rel="stylesheet" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "work.css" }}" /></noscript>
{{ end }}

<!-- Categories -->
{{ if eq .Type "categories" }}
<link rel="preload" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "categories.css" }}" as="style" onload="this.onload=null;this.rel='stylesheet'" />
<noscript><link rel="stylesheet" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "categories.css" }}" /></noscript>
{{ end }}

<!-- About -->
{{ if eq .Type "about" }}
<link rel="preload" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "about.css" }}" as="style" onload="this.onload=null;this.rel='stylesheet'" />
<noscript><link rel="stylesheet" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "about.css" }}" /></noscript>
{{ end }}


<!-- Photography -->
{{ if eq .Type "photography" }}
<link rel="preload" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "photography.css" }}" as="style" onload="this.onload=null;this.rel='stylesheet'" />
<noscript><link rel="stylesheet" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "photography.css" }}" /></noscript>
{{ end }}

<!-- Single Photography -->
{{ if and (eq .Type "photography") (eq .Kind "page") }}
<link rel="preload" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "single-photography.css" }}" as="style" onload="this.onload=null;this.rel='stylesheet'" />
<noscript><link rel="stylesheet" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "single-photography.css" }}" /></noscript>
{{ end }}

<!-- Contact -->
{{ if eq .Type "contact" }}
<link rel="preload" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "contact.css" }}" as="style" onload="this.onload=null;this.rel='stylesheet'" />
<noscript><link rel="stylesheet" href="{{ .Site.BaseURL }}css/{{ index .Site.Data.css.hash "contact.css" }}" /></noscript>
{{ end }}


<script>
  /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
  /* This file is meant as a standalone workflow for
  - testing support for link[rel=preload]
  - enabling async CSS loading in browsers that do not support rel=preload
  - applying rel preload css once loaded, whether supported or not.
  */
  (function( w ){
    "use strict";
    // rel=preload support test
    if( !w.loadCSS ){
      w.loadCSS = function(){};
    }
    // define on the loadCSS obj
    var rp = loadCSS.relpreload = {};
    // rel=preload feature support test
    // runs once and returns a function for compat purposes
    rp.support = (function(){
      var ret;
      try {
        ret = w.document.createElement( "link" ).relList.supports( "preload" );
      } catch (e) {
        ret = false;
      }
      return function(){
        return ret;
      };
    })();

    // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
    // then change that media back to its intended value on load
    rp.bindMediaToggle = function( link ){
      // remember existing media attr for ultimate state, or default to 'all'
      var finalMedia = link.media || "all";

      function enableStylesheet(){
        link.media = finalMedia;
      }

      // bind load handlers to enable media
      if( link.addEventListener ){
        link.addEventListener( "load", enableStylesheet );
      } else if( link.attachEvent ){
        link.attachEvent( "onload", enableStylesheet );
      }

      // Set rel and non-applicable media type to start an async request
      // note: timeout allows this to happen async to let rendering continue in IE
      setTimeout(function(){
        link.rel = "stylesheet";
        link.media = "only x";
      });
      // also enable media after 3 seconds,
      // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
      setTimeout( enableStylesheet, 3000 );
    };

    // loop through link elements in DOM
    rp.poly = function(){
      // double check this to prevent external calls from running
      if( rp.support() ){
        return;
      }
      var links = w.document.getElementsByTagName( "link" );
      for( var i = 0; i < links.length; i++ ){
        var link = links[ i ];
        // qualify links to those with rel=preload and as=style attrs
        if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
          // prevent rerunning on link
          link.setAttribute( "data-loadcss", true );
          // bind listeners to toggle media back
          rp.bindMediaToggle( link );
        }
      }
    };

    // if unsupported, run the polyfill
    if( !rp.support() ){
      // run once at least
      rp.poly();

      // rerun poly on an interval until onload
      var run = w.setInterval( rp.poly, 500 );
      if( w.addEventListener ){
        w.addEventListener( "load", function(){
          rp.poly();
          w.clearInterval( run );
        } );
      } else if( w.attachEvent ){
        w.attachEvent( "onload", function(){
          rp.poly();
          w.clearInterval( run );
        } );
      }
    }


    // commonjs
    if( typeof exports !== "undefined" ){
      exports.loadCSS = loadCSS;
    }
    else {
      w.loadCSS = loadCSS;
    }
  }( typeof global !== "undefined" ? global : this ) );
</script>